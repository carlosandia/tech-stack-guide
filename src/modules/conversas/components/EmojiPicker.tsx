/**
 * AIDEV-NOTE: Emoji Picker estilo WhatsApp Web
 * Categorias, busca, recentes (localStorage), grid nativo
 */

import { useState, useMemo, useCallback, useEffect, useRef } from 'react'
import {
  Smile, Users, Dog, Coffee, Plane, Gamepad2, Lightbulb, Hash, Flag, Clock,
  Search, X,
} from 'lucide-react'

// =====================================================
// Emoji Data (~400 most used emojis)
// =====================================================

const EMOJI_CATEGORIES: Record<string, { icon: React.ElementType; emojis: string[] }> = {
  'Recentes': { icon: Clock, emojis: [] },
  'Smileys': {
    icon: Smile,
    emojis: [
      'ðŸ˜€','ðŸ˜ƒ','ðŸ˜„','ðŸ˜','ðŸ˜†','ðŸ˜…','ðŸ¤£','ðŸ˜‚','ðŸ™‚','ðŸ™ƒ','ðŸ˜‰','ðŸ˜Š','ðŸ˜‡','ðŸ¥°','ðŸ˜','ðŸ¤©',
      'ðŸ˜˜','ðŸ˜—','ðŸ˜š','ðŸ˜™','ðŸ¥²','ðŸ˜‹','ðŸ˜›','ðŸ˜œ','ðŸ¤ª','ðŸ˜','ðŸ¤‘','ðŸ¤—','ðŸ¤­','ðŸ¤«','ðŸ¤”','ðŸ«¡',
      'ðŸ¤','ðŸ¤¨','ðŸ˜','ðŸ˜‘','ðŸ˜¶','ðŸ«¥','ðŸ˜','ðŸ˜’','ðŸ™„','ðŸ˜¬','ðŸ¤¥','ðŸ˜Œ','ðŸ˜”','ðŸ˜ª','ðŸ¤¤','ðŸ˜´',
      'ðŸ˜·','ðŸ¤’','ðŸ¤•','ðŸ¤¢','ðŸ¤®','ðŸ¥µ','ðŸ¥¶','ðŸ¥´','ðŸ˜µ','ðŸ¤¯','ðŸ¤ ','ðŸ¥³','ðŸ¥¸','ðŸ˜Ž','ðŸ¤“','ðŸ§',
      'ðŸ˜•','ðŸ«¤','ðŸ˜Ÿ','ðŸ™','ðŸ˜®','ðŸ˜¯','ðŸ˜²','ðŸ˜³','ðŸ¥º','ðŸ¥¹','ðŸ˜¦','ðŸ˜§','ðŸ˜¨','ðŸ˜°','ðŸ˜¥','ðŸ˜¢',
      'ðŸ˜­','ðŸ˜±','ðŸ˜–','ðŸ˜£','ðŸ˜ž','ðŸ˜“','ðŸ˜©','ðŸ˜«','ðŸ¥±','ðŸ˜¤','ðŸ˜¡','ðŸ˜ ','ðŸ¤¬','ðŸ˜ˆ','ðŸ‘¿','ðŸ’€',
      'â˜ ï¸','ðŸ’©','ðŸ¤¡','ðŸ‘¹','ðŸ‘º','ðŸ‘»','ðŸ‘½','ðŸ‘¾','ðŸ¤–','ðŸ˜º','ðŸ˜¸','ðŸ˜¹','ðŸ˜»','ðŸ˜¼','ðŸ˜½','ðŸ™€',
      'ðŸ˜¿','ðŸ˜¾','ðŸ«¶','â¤ï¸','ðŸ§¡','ðŸ’›','ðŸ’š','ðŸ’™','ðŸ’œ','ðŸ–¤','ðŸ¤','ðŸ¤Ž','ðŸ’”','â£ï¸','ðŸ’•','ðŸ’ž',
      'ðŸ’“','ðŸ’—','ðŸ’–','ðŸ’˜','ðŸ’','ðŸ’Ÿ','â™¥ï¸','ðŸ”¥','ðŸ’¯','âœ¨','â­','ðŸŒŸ','ðŸ’«','ðŸŽ‰','ðŸŽŠ',
    ],
  },
  'Pessoas': {
    icon: Users,
    emojis: [
      'ðŸ‘‹','ðŸ¤š','ðŸ–ï¸','âœ‹','ðŸ––','ðŸ«±','ðŸ«²','ðŸ«³','ðŸ«´','ðŸ‘Œ','ðŸ¤Œ','ðŸ¤','âœŒï¸','ðŸ¤ž','ðŸ«°',
      'ðŸ¤Ÿ','ðŸ¤˜','ðŸ¤™','ðŸ‘ˆ','ðŸ‘‰','ðŸ‘†','ðŸ–•','ðŸ‘‡','â˜ï¸','ðŸ«µ','ðŸ‘','ðŸ‘Ž','âœŠ','ðŸ‘Š','ðŸ¤›','ðŸ¤œ',
      'ðŸ‘','ðŸ™Œ','ðŸ«¶','ðŸ‘','ðŸ¤²','ðŸ¤','ðŸ™','âœï¸','ðŸ’…','ðŸ¤³','ðŸ’ª','ðŸ¦¾','ðŸ¦¿','ðŸ¦µ','ðŸ¦¶','ðŸ‘‚',
      'ðŸ¦»','ðŸ‘ƒ','ðŸ§ ','ðŸ«€','ðŸ«','ðŸ¦·','ðŸ¦´','ðŸ‘€','ðŸ‘ï¸','ðŸ‘…','ðŸ‘„','ðŸ«¦','ðŸ‘¶','ðŸ§’','ðŸ‘¦','ðŸ‘§',
      'ðŸ§‘','ðŸ‘±','ðŸ‘¨','ðŸ§”','ðŸ‘©','ðŸ§“','ðŸ‘´','ðŸ‘µ','ðŸ™','ðŸ™Ž','ðŸ™…','ðŸ™†','ðŸ’','ðŸ™‹','ðŸ§','ðŸ™‡',
      'ðŸ¤¦','ðŸ¤·','ðŸ‘®','ðŸ•µï¸','ðŸ’‚','ðŸ¥·','ðŸ‘·','ðŸ«…','ðŸ¤´','ðŸ‘¸','ðŸ‘³','ðŸ‘²','ðŸ§•','ðŸ¤µ','ðŸ‘°','ðŸ¤°',
    ],
  },
  'Animais': {
    icon: Dog,
    emojis: [
      'ðŸ¶','ðŸ±','ðŸ­','ðŸ¹','ðŸ°','ðŸ¦Š','ðŸ»','ðŸ¼','ðŸ»â€â„ï¸','ðŸ¨','ðŸ¯','ðŸ¦','ðŸ®','ðŸ·','ðŸ¸',
      'ðŸµ','ðŸ™ˆ','ðŸ™‰','ðŸ™Š','ðŸ’','ðŸ”','ðŸ§','ðŸ¦','ðŸ¤','ðŸ£','ðŸ¥','ðŸ¦†','ðŸ¦…','ðŸ¦‰','ðŸ¦‡',
      'ðŸº','ðŸ—','ðŸ´','ðŸ¦„','ðŸ','ðŸª±','ðŸ›','ðŸ¦‹','ðŸŒ','ðŸž','ðŸœ','ðŸª°','ðŸª²','ðŸª³','ðŸ¦Ÿ',
      'ðŸ¦—','ðŸ•·ï¸','ðŸ¦‚','ðŸ¢','ðŸ','ðŸ¦Ž','ðŸ¦–','ðŸ¦•','ðŸ™','ðŸ¦‘','ðŸ¦','ðŸ¦ž','ðŸ¦€','ðŸ¡','ðŸ ',
      'ðŸŸ','ðŸ¬','ðŸ³','ðŸ‹','ðŸ¦ˆ','ðŸª¸','ðŸŠ','ðŸ…','ðŸ†','ðŸ¦“','ðŸ¦','ðŸ¦§','ðŸ˜','ðŸ¦›','ðŸ¦',
      'ðŸª','ðŸ«','ðŸ¦’','ðŸ¦˜','ðŸ¦¬','ðŸƒ','ðŸ‚','ðŸ„','ðŸŽ','ðŸ–','ðŸ','ðŸ‘','ðŸ¦™','ðŸ','ðŸ¦Œ',
      'ðŸ•','ðŸ©','ðŸ¦®','ðŸ•â€ðŸ¦º','ðŸˆ','ðŸˆâ€â¬›','ðŸª¶','ðŸ“','ðŸ¦ƒ','ðŸ¦¤','ðŸ¦š','ðŸ¦œ','ðŸ¦¢','ðŸ¦©',
      'ðŸŒ¸','ðŸŒ¹','ðŸ¥€','ðŸŒº','ðŸŒ»','ðŸŒ¼','ðŸŒ·','ðŸŒ±','ðŸª´','ðŸŒ²','ðŸŒ³','ðŸŒ´','ðŸŒµ','ðŸŒ¾','ðŸŒ¿',
      'â˜˜ï¸','ðŸ€','ðŸ','ðŸ‚','ðŸƒ','ðŸª¹','ðŸªº','ðŸ„',
    ],
  },
  'Comida': {
    icon: Coffee,
    emojis: [
      'ðŸ‡','ðŸˆ','ðŸ‰','ðŸŠ','ðŸ‹','ðŸŒ','ðŸ','ðŸ¥­','ðŸŽ','ðŸ','ðŸ','ðŸ‘','ðŸ’','ðŸ“','ðŸ«',
      'ðŸ¥','ðŸ…','ðŸ«’','ðŸ¥¥','ðŸ¥‘','ðŸ†','ðŸ¥”','ðŸ¥•','ðŸŒ½','ðŸŒ¶ï¸','ðŸ«‘','ðŸ¥’','ðŸ¥¬','ðŸ¥¦','ðŸ§„',
      'ðŸ§…','ðŸ¥œ','ðŸ«˜','ðŸŒ°','ðŸ«š','ðŸ«›','ðŸž','ðŸ¥','ðŸ¥–','ðŸ«“','ðŸ¥¨','ðŸ¥¯','ðŸ¥ž','ðŸ§‡','ðŸ§€',
      'ðŸ–','ðŸ—','ðŸ¥©','ðŸ¥“','ðŸ”','ðŸŸ','ðŸ•','ðŸŒ­','ðŸ¥ª','ðŸŒ®','ðŸŒ¯','ðŸ«”','ðŸ¥™','ðŸ§†','ðŸ¥š',
      'ðŸ³','ðŸ¥˜','ðŸ²','ðŸ«•','ðŸ¥£','ðŸ¥—','ðŸ¿','ðŸ§ˆ','ðŸ§‚','ðŸ¥«','ðŸ±','ðŸ˜','ðŸ™','ðŸš','ðŸ›',
      'ðŸœ','ðŸ','ðŸ ','ðŸ¢','ðŸ£','ðŸ¤','ðŸ¥','ðŸ¥®','ðŸ¡','ðŸ¥Ÿ','ðŸ¥ ','ðŸ¥¡','ðŸ¦€','ðŸ¦ž','ðŸ¦',
      'ðŸ¦','ðŸ§','ðŸ¨','ðŸ©','ðŸª','ðŸŽ‚','ðŸ°','ðŸ§','ðŸ¥§','ðŸ«','ðŸ¬','ðŸ­','ðŸ®','ðŸ¯',
      'ðŸ¼','ðŸ¥›','â˜•','ðŸ«–','ðŸµ','ðŸ¶','ðŸ¾','ðŸ·','ðŸ¸','ðŸ¹','ðŸº','ðŸ»','ðŸ¥‚','ðŸ¥ƒ','ðŸ«—',
      'ðŸ¥¤','ðŸ§‹','ðŸ§ƒ','ðŸ§‰','ðŸ§Š',
    ],
  },
  'Viagens': {
    icon: Plane,
    emojis: [
      'ðŸŒ','ðŸŒŽ','ðŸŒ','ðŸŒ','ðŸ—ºï¸','ðŸ§­','ðŸ”ï¸','â›°ï¸','ðŸŒ‹','ðŸ—»','ðŸ•ï¸','ðŸ–ï¸','ðŸœï¸','ðŸï¸','ðŸžï¸',
      'ðŸŸï¸','ðŸ›ï¸','ðŸ—ï¸','ðŸ§±','ðŸª¨','ðŸªµ','ðŸ›–','ðŸ ','ðŸ¡','ðŸ¢','ðŸ£','ðŸ¤','ðŸ¥','ðŸ¦','ðŸ¨',
      'ðŸ©','ðŸª','ðŸ«','ðŸ¬','ðŸ­','ðŸ¯','ðŸ°','ðŸ’’','ðŸ—¼','ðŸ—½','â›ª','ðŸ•Œ','ðŸ›•','ðŸ•','â›©ï¸',
      'ðŸ•‹','â›²','â›º','ðŸŒ','ðŸŒƒ','ðŸ™ï¸','ðŸŒ„','ðŸŒ…','ðŸŒ†','ðŸŒ‡','ðŸŒ‰','â™¨ï¸','ðŸŽ ','ðŸ›','ðŸŽ¡',
      'ðŸŽ¢','ðŸ’ˆ','ðŸŽª','ðŸš‚','ðŸšƒ','ðŸš„','ðŸš…','ðŸš†','ðŸš‡','ðŸšˆ','ðŸš‰','ðŸšŠ','ðŸš','ðŸšž','ðŸš‹',
      'ðŸšŒ','ðŸš','ðŸšŽ','ðŸš','ðŸš‘','ðŸš’','ðŸš“','ðŸš”','ðŸš•','ðŸš–','ðŸš—','ðŸš˜','ðŸš™','ðŸ›»','ðŸšš',
      'ðŸš›','ðŸšœ','ðŸŽï¸','ðŸï¸','ðŸ›µ','ðŸ¦½','ðŸ¦¼','ðŸ›º','ðŸš²','ðŸ›´','ðŸ›¹','ðŸ›¼','ðŸš','ðŸ›£ï¸','ðŸ›¤ï¸',
      'â›½','ðŸ›ž','ðŸš¨','ðŸš¥','ðŸš¦','ðŸ›‘','ðŸš§','âš“','ðŸ›Ÿ','â›µ','ðŸ›¶','ðŸš¤','ðŸ›³ï¸','â›´ï¸','ðŸ›¥ï¸',
      'ðŸš¢','âœˆï¸','ðŸ›©ï¸','ðŸ›«','ðŸ›¬','ðŸª‚','ðŸ’º','ðŸš','ðŸšŸ','ðŸš ','ðŸš¡','ðŸ›°ï¸','ðŸš€','ðŸ›¸',
    ],
  },
  'Atividades': {
    icon: Gamepad2,
    emojis: [
      'âš½','ðŸ€','ðŸˆ','âš¾','ðŸ¥Ž','ðŸŽ¾','ðŸ','ðŸ‰','ðŸ¥','ðŸŽ±','ðŸª€','ðŸ“','ðŸ¸','ðŸ’','ðŸ‘',
      'ðŸ¥','ðŸ','ðŸªƒ','ðŸ¥…','â›³','ðŸª','ðŸ¹','ðŸŽ£','ðŸ¤¿','ðŸ¥Š','ðŸ¥‹','ðŸŽ½','ðŸ›¹','ðŸ›¼','ðŸ›·',
      'â›¸ï¸','ðŸ¥Œ','ðŸŽ¿','â›·ï¸','ðŸ‚','ðŸª‚','ðŸ‹ï¸','ðŸ¤¼','ðŸ¤¸','â›¹ï¸','ðŸ¤º','ðŸ¤¾','ðŸŒï¸','ðŸ‡','ðŸ§˜',
      'ðŸ„','ðŸŠ','ðŸ¤½','ðŸš£','ðŸ§—','ðŸšµ','ðŸš´','ðŸ†','ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰','ðŸ…','ðŸŽ–ï¸','ðŸµï¸','ðŸŽ—ï¸',
      'ðŸŽ«','ðŸŽŸï¸','ðŸŽª','ðŸ¤¹','ðŸŽ­','ðŸ©°','ðŸŽ¨','ðŸŽ¬','ðŸŽ¤','ðŸŽ§','ðŸŽ¼','ðŸŽ¹','ðŸ¥','ðŸª˜','ðŸŽ·',
      'ðŸŽº','ðŸª—','ðŸŽ¸','ðŸª•','ðŸŽ»','ðŸªˆ','ðŸŽ²','â™Ÿï¸','ðŸŽ¯','ðŸŽ³','ðŸŽ®','ðŸ•¹ï¸','ðŸ§©',
    ],
  },
  'Objetos': {
    icon: Lightbulb,
    emojis: [
      'âŒš','ðŸ“±','ðŸ“²','ðŸ’»','âŒ¨ï¸','ðŸ–¥ï¸','ðŸ–¨ï¸','ðŸ–±ï¸','ðŸ–²ï¸','ðŸ•¹ï¸','ðŸ—œï¸','ðŸ’½','ðŸ’¾','ðŸ’¿','ðŸ“€',
      'ðŸ“¼','ðŸ“·','ðŸ“¸','ðŸ“¹','ðŸŽ¥','ðŸ“½ï¸','ðŸŽžï¸','ðŸ“ž','â˜Žï¸','ðŸ“Ÿ','ðŸ“ ','ðŸ“º','ðŸ“»','ðŸŽ™ï¸','ðŸŽšï¸',
      'ðŸŽ›ï¸','ðŸ§­','â±ï¸','â²ï¸','â°','ðŸ•°ï¸','âŒ›','â³','ðŸ“¡','ðŸ”‹','ðŸª«','ðŸ”Œ','ðŸ’¡','ðŸ”¦','ðŸ•¯ï¸',
      'ðŸª”','ðŸ§¯','ðŸ›¢ï¸','ðŸ’¸','ðŸ’µ','ðŸ’´','ðŸ’¶','ðŸ’·','ðŸª™','ðŸ’°','ðŸ’³','ðŸªª','ðŸ’Ž','âš–ï¸','ðŸªœ',
      'ðŸ§°','ðŸª›','ðŸ”§','ðŸ”¨','âš’ï¸','ðŸ› ï¸','â›ï¸','ðŸªš','ðŸ”©','âš™ï¸','ðŸª¤','ðŸ§±','â›“ï¸','ðŸ§²','ðŸ”«',
      'ðŸ’£','ðŸ§¨','ðŸª“','ðŸ”ª','ðŸ—¡ï¸','âš”ï¸','ðŸ›¡ï¸','ðŸš¬','âš°ï¸','ðŸª¦','âš±ï¸','ðŸº','ðŸ”®','ðŸ“¿','ðŸ§¿',
      'ðŸª¬','ðŸ’ˆ','âš—ï¸','ðŸ”­','ðŸ”¬','ðŸ•³ï¸','ðŸ©¹','ðŸ©º','ðŸ©»','ðŸ©¼','ðŸ’Š','ðŸ’‰','ðŸ©¸','ðŸ§¬','ðŸ¦ ',
      'ðŸ§«','ðŸ§ª','ðŸŒ¡ï¸','ðŸ§¹','ðŸª ','ðŸ§º','ðŸ§»','ðŸš½','ðŸš°','ðŸš¿','ðŸ›','ðŸ›€','ðŸ§¼','ðŸª¥','ðŸª’',
      'ðŸ§½','ðŸª£','ðŸ§´','ðŸ›Žï¸','ðŸ”‘','ðŸ—ï¸','ðŸšª','ðŸª‘','ðŸ›‹ï¸','ðŸ›ï¸','ðŸ›Œ','ðŸ§¸','ðŸª†','ðŸ–¼ï¸','ðŸªž',
      'ðŸªŸ','ðŸ›ï¸','ðŸ›’','ðŸŽ','ðŸŽˆ','ðŸŽ','ðŸŽ€','ðŸª„','ðŸª…','ðŸŽŠ','ðŸŽ‰','ðŸŽŽ','ðŸ®','ðŸŽ','ðŸ§§',
      'âœ‰ï¸','ðŸ“©','ðŸ“¨','ðŸ“§','ðŸ’Œ','ðŸ“¥','ðŸ“¤','ðŸ“¦','ðŸ·ï¸','ðŸª§','ðŸ“ª','ðŸ“«','ðŸ“¬','ðŸ“­','ðŸ“®',
      'ðŸ“¯','ðŸ“œ','ðŸ“ƒ','ðŸ“„','ðŸ“‘','ðŸ§¾','ðŸ“Š','ðŸ“ˆ','ðŸ“‰','ðŸ—’ï¸','ðŸ—“ï¸','ðŸ“†','ðŸ“…','ðŸ—‘ï¸','ðŸ“‡',
      'ðŸ—ƒï¸','ðŸ—³ï¸','ðŸ—„ï¸','ðŸ“‹','ðŸ“','ðŸ“‚','ðŸ—‚ï¸','ðŸ—žï¸','ðŸ“°','ðŸ““','ðŸ“”','ðŸ“’','ðŸ“•','ðŸ“—','ðŸ“˜',
      'ðŸ“™','ðŸ“š','ðŸ“–','ðŸ”–','ðŸ§·','ðŸ”—','ðŸ“Ž','ðŸ–‡ï¸','ðŸ“','ðŸ“','ðŸ§®','ðŸ“Œ','ðŸ“','âœ‚ï¸','ðŸ–Šï¸',
      'ðŸ–‹ï¸','âœ’ï¸','ðŸ–Œï¸','ðŸ–ï¸','ðŸ“','âœï¸','ðŸ”','ðŸ”Ž','ðŸ”','ðŸ”','ðŸ”’','ðŸ”“',
    ],
  },
  'SÃ­mbolos': {
    icon: Hash,
    emojis: [
      'â¤ï¸','ðŸ§¡','ðŸ’›','ðŸ’š','ðŸ’™','ðŸ’œ','ðŸ–¤','ðŸ¤','ðŸ¤Ž','ðŸ’”','â£ï¸','ðŸ’•','ðŸ’ž','ðŸ’“','ðŸ’—',
      'ðŸ’–','ðŸ’˜','ðŸ’','ðŸ’Ÿ','â˜®ï¸','âœï¸','â˜ªï¸','ðŸ•‰ï¸','â˜¸ï¸','âœ¡ï¸','ðŸ”¯','ðŸ•Ž','â˜¯ï¸','â˜¦ï¸','ðŸ›',
      'â›Ž','â™ˆ','â™‰','â™Š','â™‹','â™Œ','â™','â™Ž','â™','â™','â™‘','â™’','â™“','ðŸ†”','âš›ï¸',
      'ðŸ‰‘','â˜¢ï¸','â˜£ï¸','ðŸ“´','ðŸ“³','ðŸˆ¶','ðŸˆš','ðŸˆ¸','ðŸˆº','ðŸˆ·ï¸','âœ´ï¸','ðŸ†š','ðŸ’®','ðŸ‰','ãŠ™ï¸',
      'ãŠ—ï¸','ðŸˆ´','ðŸˆµ','ðŸˆ¹','ðŸˆ²','ðŸ…°ï¸','ðŸ…±ï¸','ðŸ†Ž','ðŸ†‘','ðŸ…¾ï¸','ðŸ†˜','âŒ','â­•','ðŸ›‘','â›”',
      'ðŸ“›','ðŸš«','ðŸ’¯','ðŸ’¢','â™¨ï¸','ðŸš·','ðŸš¯','ðŸš³','ðŸš±','ðŸ”ž','ðŸ“µ','ðŸš­','â—','â•','â“',
      'â”','â€¼ï¸','â‰ï¸','ðŸ”…','ðŸ”†','ã€½ï¸','âš ï¸','ðŸš¸','ðŸ”±','âšœï¸','ðŸ”°','â™»ï¸','âœ…','ðŸˆ¯','ðŸ’¹',
      'â‡ï¸','âœ³ï¸','âŽ','ðŸŒ','ðŸ’ ','â“‚ï¸','ðŸŒ€','ðŸ’¤','ðŸ§','ðŸš¾','â™¿','ðŸ…¿ï¸','ðŸ›—','ðŸˆ³','ðŸˆ‚ï¸',
      'ðŸ›‚','ðŸ›ƒ','ðŸ›„','ðŸ›…','ðŸš¹','ðŸšº','ðŸš»','ðŸš¼','ðŸš®','ðŸŽ¦','ðŸ“¶','ðŸˆ','ðŸ”£','â„¹ï¸','ðŸ”¤',
      'ðŸ”¡','ðŸ” ','ðŸ†–','ðŸ†—','ðŸ†™','ðŸ†’','ðŸ†•','ðŸ†“','0ï¸âƒ£','1ï¸âƒ£','2ï¸âƒ£','3ï¸âƒ£','4ï¸âƒ£','5ï¸âƒ£',
      '6ï¸âƒ£','7ï¸âƒ£','8ï¸âƒ£','9ï¸âƒ£','ðŸ”Ÿ','ðŸ”¢','#ï¸âƒ£','*ï¸âƒ£','âï¸','â–¶ï¸','â¸ï¸','â¯ï¸','â¹ï¸','âºï¸',
      'â­ï¸','â®ï¸','â©','âª','â«','â¬','â—€ï¸','ðŸ”¼','ðŸ”½','âž¡ï¸','â¬…ï¸','â¬†ï¸','â¬‡ï¸','â†—ï¸','â†˜ï¸',
      'â†™ï¸','â†–ï¸','â†•ï¸','â†”ï¸','â†ªï¸','â†©ï¸','â¤´ï¸','â¤µï¸','ðŸ”€','ðŸ”','ðŸ”‚','ðŸ”„','ðŸ”ƒ','ðŸŽµ','ðŸŽ¶',
      'âž•','âž–','âž—','âœ–ï¸','ðŸŸ°','â™¾ï¸','ðŸ’²','ðŸ’±','â„¢ï¸','Â©ï¸','Â®ï¸','ðŸ‘ï¸â€ðŸ—¨ï¸','ðŸ”š','ðŸ”™','ðŸ”›',
      'ðŸ”','ðŸ”œ','ã€°ï¸','âž°','âž¿','âœ”ï¸','â˜‘ï¸','ðŸ”˜','ðŸ”´','ðŸŸ ','ðŸŸ¡','ðŸŸ¢','ðŸ”µ','ðŸŸ£','âš«',
      'âšª','ðŸŸ¤','ðŸ”º','ðŸ”»','ðŸ”¸','ðŸ”¹','ðŸ”¶','ðŸ”·','ðŸ”³','ðŸ”²','â–ªï¸','â–«ï¸','â—¾','â—½','â—¼ï¸',
      'â—»ï¸','ðŸŸ¥','ðŸŸ§','ðŸŸ¨','ðŸŸ©','ðŸŸ¦','ðŸŸª','â¬›','â¬œ','ðŸŸ«','ðŸ”ˆ','ðŸ”‡','ðŸ”‰','ðŸ”Š','ðŸ””',
      'ðŸ”•','ðŸ“£','ðŸ“¢','ðŸ’¬','ðŸ’­','ðŸ—¯ï¸','â™ ï¸','â™£ï¸','â™¥ï¸','â™¦ï¸','ðŸƒ','ðŸŽ´','ðŸ€„','ðŸ•','ðŸ•‘',
    ],
  },
  'Bandeiras': {
    icon: Flag,
    emojis: [
      'ðŸ','ðŸš©','ðŸŽŒ','ðŸ´','ðŸ³ï¸','ðŸ³ï¸â€ðŸŒˆ','ðŸ³ï¸â€âš§ï¸','ðŸ´â€â˜ ï¸',
      'ðŸ‡§ðŸ‡·','ðŸ‡ºðŸ‡¸','ðŸ‡¦ðŸ‡·','ðŸ‡µðŸ‡¹','ðŸ‡ªðŸ‡¸','ðŸ‡«ðŸ‡·','ðŸ‡©ðŸ‡ª','ðŸ‡®ðŸ‡¹','ðŸ‡¬ðŸ‡§','ðŸ‡¯ðŸ‡µ','ðŸ‡°ðŸ‡·','ðŸ‡¨ðŸ‡³',
      'ðŸ‡²ðŸ‡½','ðŸ‡¨ðŸ‡´','ðŸ‡¨ðŸ‡±','ðŸ‡µðŸ‡ª','ðŸ‡ºðŸ‡¾','ðŸ‡µðŸ‡¾','ðŸ‡§ðŸ‡´','ðŸ‡ªðŸ‡¨','ðŸ‡»ðŸ‡ª','ðŸ‡¨ðŸ‡º','ðŸ‡¨ðŸ‡·','ðŸ‡µðŸ‡¦',
      'ðŸ‡¨ðŸ‡¦','ðŸ‡¦ðŸ‡º','ðŸ‡³ðŸ‡¿','ðŸ‡®ðŸ‡³','ðŸ‡·ðŸ‡º','ðŸ‡¹ðŸ‡·','ðŸ‡¸ðŸ‡¦','ðŸ‡¦ðŸ‡ª','ðŸ‡®ðŸ‡±','ðŸ‡ªðŸ‡¬','ðŸ‡¿ðŸ‡¦','ðŸ‡³ðŸ‡¬',
      'ðŸ‡°ðŸ‡ª','ðŸ‡¬ðŸ‡­','ðŸ‡²ðŸ‡¦','ðŸ‡¹ðŸ‡³','ðŸ‡¸ðŸ‡ª','ðŸ‡³ðŸ‡´','ðŸ‡©ðŸ‡°','ðŸ‡«ðŸ‡®','ðŸ‡®ðŸ‡¸','ðŸ‡³ðŸ‡±','ðŸ‡§ðŸ‡ª','ðŸ‡¨ðŸ‡­',
      'ðŸ‡¦ðŸ‡¹','ðŸ‡µðŸ‡±','ðŸ‡¨ðŸ‡¿','ðŸ‡·ðŸ‡´','ðŸ‡­ðŸ‡º','ðŸ‡¬ðŸ‡·','ðŸ‡®ðŸ‡ª','ðŸ‡­ðŸ‡·','ðŸ‡·ðŸ‡¸','ðŸ‡§ðŸ‡¬','ðŸ‡ºðŸ‡¦',
    ],
  },
}

const RECENT_KEY = 'emoji_picker_recentes'
const MAX_RECENT = 24

function getRecentEmojis(): string[] {
  try {
    const stored = localStorage.getItem(RECENT_KEY)
    return stored ? JSON.parse(stored) : []
  } catch {
    return []
  }
}

function saveRecentEmoji(emoji: string) {
  try {
    const recentes = getRecentEmojis().filter(e => e !== emoji)
    recentes.unshift(emoji)
    localStorage.setItem(RECENT_KEY, JSON.stringify(recentes.slice(0, MAX_RECENT)))
  } catch {}
}

// =====================================================
// Search index (built once)
// =====================================================

const EMOJI_SEARCH_MAP: Record<string, string[]> = {}
Object.entries(EMOJI_CATEGORIES).forEach(([cat, { emojis }]) => {
  if (cat === 'Recentes') return
  emojis.forEach(e => {
    if (!EMOJI_SEARCH_MAP[e]) EMOJI_SEARCH_MAP[e] = []
    EMOJI_SEARCH_MAP[e].push(cat.toLowerCase())
  })
})

// =====================================================
// Component
// =====================================================

interface EmojiPickerProps {
  onSelect: (emoji: string) => void
  onClose: () => void
}

export function EmojiPicker({ onSelect, onClose }: EmojiPickerProps) {
  const [activeCategory, setActiveCategory] = useState('Smileys')
  const [search, setSearch] = useState('')
  const [recentes, setRecentes] = useState<string[]>(getRecentEmojis)
  const gridRef = useRef<HTMLDivElement>(null)
  const searchRef = useRef<HTMLInputElement>(null)

  useEffect(() => {
    searchRef.current?.focus()
  }, [])

  // Close on Escape
  useEffect(() => {
    const handler = (e: KeyboardEvent) => {
      if (e.key === 'Escape') onClose()
    }
    window.addEventListener('keydown', handler)
    return () => window.removeEventListener('keydown', handler)
  }, [onClose])

  const handleSelect = useCallback((emoji: string) => {
    saveRecentEmoji(emoji)
    setRecentes(getRecentEmojis())
    onSelect(emoji)
  }, [onSelect])

  const filteredEmojis = useMemo(() => {
    if (!search.trim()) return null
    const term = search.toLowerCase()
    const all = Object.values(EMOJI_CATEGORIES).flatMap(c => c.emojis)
    const unique = [...new Set(all)]
    // Simple filter: match category name or just show all (emoji search is hard without names)
    // For now return all emojis that match via category
    return unique.filter(e => {
      const cats = EMOJI_SEARCH_MAP[e] || []
      return cats.some(c => c.includes(term))
    })
  }, [search])

  const categories = Object.keys(EMOJI_CATEGORIES)
  const currentEmojis = filteredEmojis
    || (activeCategory === 'Recentes' ? recentes : EMOJI_CATEGORIES[activeCategory]?.emojis || [])

  return (
    <div className="w-[320px] h-[380px] bg-popover border border-border rounded-lg shadow-xl flex flex-col overflow-hidden z-50">
      {/* Search bar */}
      <div className="px-3 pt-3 pb-2">
        <div className="relative">
          <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground" />
          <input
            ref={searchRef}
            type="text"
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            placeholder="Pesquisar emoji..."
            className="w-full pl-8 pr-8 py-1.5 text-xs bg-muted/50 border border-border/50 rounded-md focus:outline-none focus:ring-1 focus:ring-ring placeholder:text-muted-foreground"
          />
          {search && (
            <button
              onClick={() => setSearch('')}
              className="absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
            >
              <X className="w-3.5 h-3.5" />
            </button>
          )}
        </div>
      </div>

      {/* Category tabs */}
      {!search && (
        <div className="flex items-center gap-0.5 px-2 pb-1 border-b border-border/30">
          {categories.map((cat) => {
            const Icon = EMOJI_CATEGORIES[cat].icon
            const isActive = activeCategory === cat
            return (
              <button
                key={cat}
                onClick={() => { setActiveCategory(cat); gridRef.current?.scrollTo(0, 0) }}
                className={`p-1.5 rounded-md transition-colors ${
                  isActive ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-accent/50'
                }`}
                title={cat}
              >
                <Icon className="w-4 h-4" />
              </button>
            )
          })}
        </div>
      )}

      {/* Emoji grid */}
      <div ref={gridRef} className="flex-1 overflow-y-auto px-2 py-1.5">
        {!search && (
          <p className="text-[10px] text-muted-foreground font-medium px-1 mb-1 uppercase tracking-wider">
            {activeCategory}
          </p>
        )}
        {currentEmojis.length === 0 ? (
          <p className="text-xs text-muted-foreground text-center py-8">
            {activeCategory === 'Recentes' ? 'Nenhum emoji recente' : 'Nenhum resultado'}
          </p>
        ) : (
          <div className="grid grid-cols-8 gap-0.5">
            {currentEmojis.map((emoji, idx) => (
              <button
                key={`${emoji}-${idx}`}
                onClick={() => handleSelect(emoji)}
                className="w-9 h-9 flex items-center justify-center text-xl rounded-md hover:bg-accent/60 transition-colors"
                title={emoji}
              >
                {emoji}
              </button>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}
